version: '2.1'
  
services:
  privatebin:
    image: privatebin/nginx-fpm-alpine 
    container_name: privatebin
    read_only: true
    restart: unless-stopped
    volumes:
      - data:/srv/data:z
      - run:/run:z
      - nginx_tmp:/var/lib/nginx/tmp:z
      - tmp:/tmp:z
    networks:
      inverseproxy_shared:
    labels:
      traefik.docker.network: "inverseproxy_shared"
      traefik.enable: "true"
      traefik.http.routers.privatebin-unsec.entrypoints: "http"
      traefik.http.routers.privatebin-unsec.middlewares: "https-redirect@file"
      traefik.http.routers.privatebin-unsec.rule: "Host(`{{ privatebin_url }}`)"
      traefik.http.routers.privatebin.entrypoints: "https"
      traefik.http.routers.privatebin.middlewares: "security-headers@file"
      traefik.http.routers.privatebin.rule: "Host(`{{ privatebin_url }}`)"
      traefik.http.routers.privatebin.service: "privatebin"
      traefik.http.routers.privatebin.tls: "true"
      traefik.http.routers.privatebin.tls.certresolver: "le"
      traefik.http.routers.privatebin.tls.options: "default@file"
      traefik.http.services.privatebin.loadbalancer.server.port: "80"

networks:
    inverseproxy_shared:
        external: true

volumes:
    data:
    run:
    nginx_tmp:
    tmp:
